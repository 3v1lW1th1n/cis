---
copyright:
  years: 2018
lastupdated: "2018-03-12"
---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# キャッシング動作を含むページ・ルールの使用

ページ・ルールを使用することにより、リダイレクトの作成、キャッシング動作の微調整、サービスの有効化と無効化など、ページの URL に基づいたさまざまなアクションを実行できます。

ページ・ルールは、次の形式と一致する、ある特定の URL パターンに対して実施されます。

`<scheme>://<hostname><:port>/<path>`

例えば次のようにします。

`https://www.example.com:80/image.png`

`scheme` 構成要素と `port` 構成要素はオプションです。`scheme` 構成要素が省略された場合は、形式として `http://` プロトコルと `https://` プロトコルが受け入れられます。`port` が指定されなかった場合、ルールはすべてのポートと一致します。ルール・パターンの中で `*` 記号を使用して一連の類似パターンに一致させることにより、基本的なワイルドカード・マッチングを行えます。

**ページ・ルールに関して留意すべき重要事項:**

 * ある特定の要求に対して実施されるページ・ルールは 1 つだけです。
 * ページ・ルールには上から下への順序で優先順位が与えられます。ある URL があるルールと一致すると、そのルールのみが適用されます。つまり、要求に対して既にページ・ルールがトリガーされていれば、何らかの後続ルールがさらにその URL パターンと一致しても、そのルールは実施されません。 
 * 原則として、固有性の高いものから低いものへとルールを順序付けすることをお勧めします。
 * ページ・ルールを無効にすることができます。その場合、アクションはまったく実行されなくなりますが、依然としてリストに表示され、編集できます。*「有効」*トグルを「オフ」に設定すると、最初に「無効」に設定されたページ・ルールが作成されます。


## 転送 (URL リダイレクト)
HTTP 301 または 302 リダイレクトを使用して、ある URL を別の URL にリダイレクトします。ワイルドカードが一致した URL のいずれのセクションの内容も、`$X` 構文を使用して参照できます。`X` は、パターン内のグロブのインデックスを示します。つまり、`$1` は最初のワイルドカードが一致したものに置き換えられ、`$2` は 2 番目のワイルドカードが一致したものに置き換えられます。

例えば、次のルールを設定したとします。

![画像](images/url-redirection-example.png)

この場合、「www.example.com/stuff/things」に対する要求は「http://example.com/stuff/things」にリダイレクトされます。

**注:** ドメインがそれ自体を宛先として指すリダイレクトは作成しないよう気を付けてください。この誤りが原因で無限リダイレクト・エラーになる可能性があり、その場合は、影響を受ける URL を解決できないことになります。


## HTTPS へのリダイレクト
HTTPS を使用するよう訪問者をリダイレクトする場合は、代わりに**「常に HTTPS を使用 (Always Use HTTPS)」**設定を使用します。

![画像 2](images/url-matching-patterns.png)


## カスタム・キャッシング
いずれかの標準キャッシュ・レベルを使用して、ページ・ルールのパターンと一致する URL のキャッシング動作を設定します。**「キャッシュ・レベル (Cache Level)」**を**「すべてキャッシュ (Cache Everything)」**に設定すると、デフォルトの静的ファイル・タイプのいずれでもなくても、すべてのコンテンツがキャッシュされます。**「キャッシュ・レベル (Cache Level)」**を**「バイパス (Bypass)」**に設定すると、その URL のキャッシングが行われなくなります。

ページ・ルールを使用してキャッシュ・レベルを指定するときに、**「エッジ・キャッシュの TTL (Edge Cache TTL)」**を設定できます。この設定を使用して、CIS がキャッシュ内にファイルを保持する時間を制御できます。

**「ブラウザー・キャッシュの TTL (Browser Cache TTL)」**は、クライアント・ブラウザーによってキャッシュされたリソースが有効であり続ける時間を制御します。ブラウザーが再びリソースを要求した場合、TTL が有効期限切れになっていなければ、ブラウザーは `HTTP 304 (Not Modified)` 応答を受け取ります。30 分から 1 年までの範囲で TTL を設定できます。

デフォルトのキャッシング動作のすべてが厳密に RFC に準拠しているというわけではありません。ページ・ルールを使用して**「起点キャッシュ制御 (Origin Cache Control)」**を設定すると、主に再検証に関して RFC をより厳密に順守しようとする新しいキャッシング・ルール・セットが使用されます。例えば、`max-age=0` の場合のデフォルト動作では、まったくキャッシュされません。これに対して、**「起点キャッシュ制御 (Origin Cache Control)」**を設定すると、キャッシュされて常に再検証されます。

次の例では、`/images` フォルダーにあるすべてをキャッシュするようページ・ルールが設定されます。キャッシュされたリソースは、ユーザーのブラウザーでは 30 分後に有効期限切れになり、IBM CIS データ・センターでは 1 日後に有効期限切れになります。

![画像 3](images/url-example.png)
