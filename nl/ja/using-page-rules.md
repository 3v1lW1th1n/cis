---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: Use Page Rules, Page Rule

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}


# ページ・ルールの使用
{:#use-page-rules}

ページ・ルールによって、ドメインを参照する特定の URL パターンに適用できるいくつかの設定と値が指定されます。 ページ・ルールは、サイト内の個々の URL に基づいてセキュリティー、パフォーマンス、信頼性を管理する際に役立ちます。 以下の表に、すべての顧客が使用できるページ・ルール、それらによって発生する動作、およびそれらを使用する前に留意すべき特別な考慮事項の説明を示します。

## セキュリティー
{:#page-rules-security}

| **設定** | **動作** | **考慮事項** |
|-----------|----------|----------------|
|**ブラウザー保全性検査 (Browser Integrity Check)**|スパマーに悪用される一般的な HTTP ヘッダーを見つけて、ページへのアクセスを拒否します。 ユーザー・エージェントを持たない訪問者をブロックします、また、標準外のユーザー・エージェント (通常、悪意のあるボット、クローラー、API などでも使用される) を追加する訪問者もブロックします。 | |
|**セキュリティーの無効化 (Disable Security)**|以下の機能を無効にします。 <ul><li>E メールの難読化</li> <li>サーバー・サイドの除外</li> <li>WAF</li></ul>|あるルールでセキュリティーを無効化する設定がされていて、別のルールで WAF を有効化する設定がされている場合は、それらが表示される順序とは関係なく、WAF ルールが優先されます。|
|**E メールの難読化 (Email Obfuscation)**|E メールの難読化をオンまたはオフに切り替えます。 | |
|**IP 地理位置情報ヘッダー (IP Geolocation Header)**|Web サイトに対するすべての要求で、訪問者のロケーションの国別コードが含まれます。 この情報は `CF-IPCountry` HTTP ヘッダーにあります。 | |  
|**セキュリティー・レベル (Security Level)**|クライアントがユーザー確認ページに到達するのに必要なクライアントの脅威スコアの高さを制御します。 この設定を使用すると、サイトを訪問したときに、その訪問者に対して常に**「防御モード (Defense Mode)」**でユーザー確認が行われます。 | |
|**サーバー・サイドの除外 (Server Side Excludes)**|サーバー・サイドの除外をオンまたはオフに切り替えます。  | |
|**TLS**|どの TLS モードを使用するかを制御します。 | |
|**WAF**|WAF をオンまたはオフに切り替えます。 | |  
|**HTTPS 自動再書き込み (Automatic HTTPS Rewrites)**|HTTPS 自動再書き込みをオンまたはオフに切り替えます。  | |
|**便宜的暗号化 (Opportunistic Encryption)**|便宜的暗号化をオンまたはオフに切り替えます。  | |
|**キャッシュ・ディセプション・アーマー (Cache Deception Armor)**|キャッシュ・ディセプション・アーマーをオンまたはオフに切り替えます。  | |
|**常に HTTPS を使用 (Always Use HTTPS)**|`301` リダイレクトを作成して、`http://` URL を `https://` URL に変換します。|この設定を使用すると、IBM CIS によって要求の `HTTPS` へのリダイレクトが強制されるため、ルールに対するその他すべての設定の構成が無効になります。これは新規の要求になり、その後ページ・ルールに対して評価されます。 |
|**真のクライアント IP ヘッダー**|CIS が `True-Client-IP` ヘッダー内のエンド・ユーザーの IP アドレスを送信するようになります。|エンタープライズのみ|

## パフォーマンス
{:#page-rules-performance}

| **設定** | **動作** | **考慮事項** |
|-----------|----------|----------------|
|**ブラウザー・キャッシュ TTL (Browser Cache TTL)**|クライアント・ブラウザーによってキャッシュされたリソースの有効性が維持される期間を制御します。 | |
|**Cookie のキャッシュのバイパス (Bypass Cache on Cookie)**|特定名の Cookie が表示されない場合に、キャッシュされたオブジェクトを提供します。例えば、顧客がログインしているため、パーソナライズされたコンテンツを提示する必要があることを示す `SessionID` Cookie が表示されない場合に、ホーム・ページのキャッシュ・バージョンを提供します。 | |
|**キャッシュ・レベル (Cache Level)**|**バイパス (Bypass)** - そのページ・ルールに一致するリソースはキャッシュされません。<br>**照会ストリングなし (No query string)** - 照会ストリングがない場合、キャッシュからリソースのみを提供します。<br>**照会ストリングを無視 (Ignore query string)** - 照会ストリングに関係なく、すべてのユーザーに同じリソースを提供します。<br>**標準 (Standard)** - 照会ストリングが変更されるたびに、異なるリソースを提供します。<br> **すべてキャッシュ (Cache everything)** - ページ・ルールに一致するリソースがキャッシュされます。|デフォルトでは、HTML コンテンツはキャッシュされません。 静的 HTML コンテンツをキャッシュするページ・ルールを作成する必要があります。 |
|**エッジ・キャッシュ TTL (Edge Cache TTL)**|IBM CIS によって、キャッシュにファイルが保持される期間を制御します。 |キャッシュ・レベルを指定する場合、この設定はオプションです。 |
|**オーバーライドの解決**|ページ・ルールに一致する要求が解決する URL または IP を変更します。||
|**Cookie 上のキャッシュ**|Cookie 名に対する正規表現のマッチングに基づいて`「すべてをキャッシュ」`オプション (`「キャッシュ・レベル」`設定) を適用します。この設定と`「Cookie 上でキャッシュをバイパスする」`を同じページ・ルールに追加した場合、`「Cookie 上のキャッシュ」`が`「Cookie 上でキャッシュをバイパスする」`よりも優先されます。|エンタープライズのみ|
|**パフォーマンスを無効にする**|次をオフにします。
<ul><li>`Web コンテンツの縮小`</li><li>`イメージ・ロードの最適化`
</li><li>`イメージ・サイズの最適化`</li><li>`スクリプト・ロードの最適化`
</li></ul> |エンタープライズのみ|
|**Web コンテンツの縮小**|これらのファイルから不要な文字列をすべて削除することによって、HTML、CSS、JavaScript ファイルを縮小します。|エンタープライズのみ|
|**イメージ・ロードの最適化**|以下の方法を用いて、ネットワーク接続およびデバイス・タイプに基づき、イメージが含まれるページのロード時間を改善します。
<ul><li>**イメージの仮想化** - オリジナルと同じディメンションを持つ、低い解像度のプレースホルダー・イメージでイメージを置き換えます (サード・パーティーのイメージも含む)。ページが完全にレンダリングされると、最大解像度のイメージは遅延ロードされます (ブラウザー・ビューポートにあるイメージを優先します)。このプロセスにより、ページを素早くレンダリングし、ブラウザーの再フローを最小化します。
</li><li>**要求の簡素化** - イメージに関する複数の個々のネットワーク要求を 1 つの要求にまとめます。</li></ul> |エンタープライズのみ|
|**イメージ・サイズの最適化**|メタデータ (日時、カメラの製造元、モデルなど) を除くことによってイメージ・ファイル・サイズを小さくします。また、可能な場合にイメージを圧縮します。ファイル・サイズが小さくなると、イメージや Web ページのロード時間は短くなります。|エンタープライズのみ|
|**照会ストリングのソート**|照会ストリングの順番にかかわらず、キャッシュ内の同じファイルと同じ照会ストリングを持つファイルを処理します。|エンタープライズのみ|
|**応答バッファリング**|起点サーバーからの応答のバッファリングを有効/無効にします。デフォルトでは、CIS は、受信したとおりにパケットをクライアントに送信します。「応答バッファリング」を有効にすると、CIS はファイル全体が揃うまで、エンド・ユーザーに転送するのを待つようになります。|エンタープライズのみ|
|**スクリプト・ロードの最適化**|ページのコンテンツのレンダリングが妨げられないように、Javascript (サード・パーティーのスクリプトも含む) を非同期的にロードすることによって、ペイント時間を改善します。|エンタープライズのみ|

## 信頼性
{:#page-rules-reliability}

| **設定** | **動作** | **考慮事項** |
|-----------|----------|----------------|
|**失効コンテンツの提供**|サーバーがダウンした場合に、サイトの制限バージョンをオンライン状態のままにします。 |詳しくは、[最適な信頼性を確保するための IBM CIS デプロイメントの管理](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability)を参照してください。 |
|**起点キャッシュ制御 (Origin Cache Control)**|起点からキャッシュされるコンテンツ、およびそのコンテンツが更新される頻度を決定します。 |詳しくは、[最適な信頼性を確保するための IBM CIS デプロイメントの管理](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability)を参照してください。 |
|**転送用 URL (Forwarding URL)** |サイトが使用不可の場合に使用される URL。 | これを使用すると、要求が他の場所に転送されるため、その他すべての設定の構成が無効になります。 詳しくは、[最適な信頼性を確保するための IBM CIS デプロイメントの管理](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability)を参照してください。|
|**ホスト・ヘッダーのオーバーライド**|ページ・ルールに一致する URI のホスト・ヘッダーを、指定した値に置き換えます。これは、S3 バケットでホストされるコンテンツに対して一般的に使用されます。|
|**アプリを無効にする**|すべての CIS アプリをオフにします。|エンタープライズのみ|
|**起点エラー・ページのパススルー**|発信元サーバーから送信される、問題のトリガーとなる CIS エラー・ページを無効にし、発信元で設定されているエラー・ページを表示します。|エンタープライズのみ||

## ページ・ルール URL のパターン
{:#page-rule-url-patterns}

ページ・ルールは、次のフォーマットに一致する、指定された URL パターンに対して有効です。

`<scheme>://<hostname><:port>/<path>`

各コンポーネントの使用例は次のとおりです。

`https://www.example.com:80/image.png`

*スキーム*・コンポーネントと*ポート*・コンポーネントはオプションです。 スキームは、省略されている場合は `http://` プロトコルと `https://` プロトコルの両方をカバーします。 ポートが指定されない場合、ルールは、すべてのポートを突き合わせます。 ルール・パターンに「*」記号を使用すると、基本的なワイルドカードの突き合わせを実行できます。これにより、1 つだけでなく、類似する一連のパターンを突き合わせることができます。

以下に、ページ・ルールで留意すべき 3 つの重要事項を示します。

 * 指定された要求に対して有効なページ・ルールは 1 つだけです。
 * ページ・ルールの優先順位は、上から下の順になります。
 * URL がルールに一致すると、そのルールのみが適用されます。つまり、要求でページ・ルールがトリガーされた場合、その URL パターンに一致する後続のルールがあっても、それは有効になりません。 原則として、_固有性の高いもの_ から_低いもの_ へとルールを順序付けすることをお勧めします。

ページ・ルールは無効にできます。この場合、これらは何の処理も行いません。 これらは引き続きリストに表示され、編集可能です。 **「有効」**トグルを**「オフ」**に設定すると、ページ・ルールが作成されますが、最初は無効になっています。

詳しくは、[キャッシングおよびページ・ルールの使用方法に関する文書](/docs/infrastructure/cis?topic=cis-use-page-rules-with-caching)を参照してください。
