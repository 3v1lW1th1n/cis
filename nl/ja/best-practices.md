---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: Best practices, CIS setup

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}

# CIS セットアップのベスト・プラクティス
{:#best-practices-for-cis-setup}

IBM CIS はご使用のネットワークのエッジに置かれているため、CIS サービスと円滑に統合されるようにするためには、いくつかのステップを実行する必要があります。 ご使用の起点サーバーと CIS を統合するためのいくつかの推奨ベスト・プラクティスを以下に示します。 

これらのステップは、DNS の変更とプロキシー・サービスのアクティブ化の前でも後でも行えます。 これらの推奨ベスト・プラクティスを実行することによって、ご使用の起点サーバーに IBM CIS が適切に接続できるようになります。 これらの推奨ベスト・プラクティスにより、API トラフィックや HTTPS トラフィックの問題が起こらないようにすることができます。また、保護 CIS IP アドレスではなく、顧客の正しい IP アドレスをログに取り込めるようになります。

必要になるセットアップ内容を以下に示します。

 * ベスト・プラクティス 1: 顧客の起点 IP を復元する
 * ベスト・プラクティス 2: CIS IP アドレスを取り込む
 * ベスト・プラクティス 3: セキュリティー設定が API トラフィックの妨げにならないようにする
 * ベスト・プラクティス 4: できるだけ厳密にセキュリティー設定を構成する
 
## ベスト・プラクティス 1: 顧客の起点 IP を復元するための方法を知る
{:#best-practice-know-how-to-restore-origininating-ip}

リバース・プロキシーでは、以下のヘッダーで起点 IP が示されます。

  * `CF-Connecting-IP`
  * `X-Forwarded-For`
  * `True-Client-IP` (オプション)

Apache、Windows IIS、NGINX などのインフラストラクチャー用のさまざまなツールを使用して、ユーザーの IP アドレスを復元できます。

## ベスト・プラクティス 2: 統合をより円滑にするために CIS IP アドレスを取り込む
{:#best-practice-incorporate-cis-ip-addresses}

実行すべき 2 つのステップを以下に示します。

  * CIS IP アドレスの速度制限を解除する
  * CIS IP アドレスなどの信頼できるパーティーのみ許可するように ACL をセットアップする

IBM CIS 用 IP 範囲の更新済みリストは、[この場所](/docs/infrastructure/cis?topic=cis-ibm-cloud-cis-whitelisted-ip-addresses)にあります。

## ベスト・プラクティス 3: API トラフィックの妨げにならないようセキュリティー設定を確認する
{:#best-practice-review-security-settings-interference}

IBM CIS は通常、接続オーバーヘッドを取り除くことによって API トラフィックを加速します。 一方、デフォルトのセキュリティー・スタンスは、さまざまな API 呼び出しの妨げになることがあります。 プロキシーがアクティブになったら、API トラフィックの妨げにならないようにするためのいくつかのアクションを実行することをお勧めします。

 * **ページ・ルール**機能を使用し、セキュリティー機能を選んでオフにします。
   * ご使用の API の URL パターン (例えば `api.example.com` など) を使用してページ・ルールを作成します。
   * 以下のルール動作を追加します。
     * **「セキュリティー・レベル (Security Level)」**として**「基本的にオフ (Essentially off)」**を選択します
     * **「TLS」**として**「オフ (Off)」**を選択します
     * **「ブラウザー保全性チェック (Browser Integrity Check)」**として**「オフ (Off)」**を選択します
   * **「リソースのプロビジョン (Provision Resource)」**を選択します。

 * あるいは、「セキュリティー」ページから、**「Web アプリケーション・ファイアウォール (Web Application Firewall)」**をグローバルにオフにすることもできます。

| *「ブラウザー保全性チェック (Browser Integrity Check)」の内容* | 
|------------------------------------------------|
| *ブラウザー保全性チェックでは、スパマーがよく不正使用する HTTP ヘッダーを探します。 ご使用のページに対してそうしたヘッダーを含むトラフィックがアクセスするのを拒否します。 また、ユーザー・エージェントを使用していない訪問者や、非標準のユーザー・エージェントを追加している (この手法は、悪用ボット、クローラー、または API でよく使用される) 訪問者をブロックします。* |

## ベスト・プラクティス 4: できるだけ厳密にセキュリティー設定を構成する
{:#best-practice-configure-stict-security-settings}

CIS には、トラフィックを暗号化するためのオプションがいくつか用意されています。 リバース・プロキシーでは、データ・センターでの TLS 接続が閉じられ、起点サーバーへの新規 TLS 接続が開かれます。 CIS を含む終端用に、ご使用のアカウントからカスタム証明書をアップロードすることも、CIS によってプロビジョンされたワイルドカード証明書を使用することもできます。あるいは、その両方を行うこともできます。

### カスタム証明書をアップロードする
{:#strict-upload-custom-cert}
 
エンタープライズ・ドメインの作成時に、公開鍵と秘密鍵をアップロードできます。 お客様独自の証明書をアップロードした場合は、暗号化トラフィックとの互換性が直ちに得られ、証明書 (例えば Extended Validation (EV) 証明書) に対する管理を維持することになります。 カスタム証明書をアップロードした場合は証明書の管理が必要になるということに注意してください。 例えば、IBM CIS は証明書の有効期限を追跡しません。 
 
### あるいは、CIS によってプロビジョンされた証明書を使用する
{:#strict-utilize-cert-cis-provisioned}
 
デフォルトでは、IBM CIS はいくつかの認証局 (CA) と連携して、お客様のドメインのワイルドカード証明書を提供します。 このような証明書をセットアップするためには手動検証が必要になる場合がありますが、そうした追加ステップの実行をサポート・チームが支援します。
 
### TLS 設定を**「エンドツーエンド CA 署名 (End-to-End CA Signed)」**に変更する
{:#strict-change-tls-setting}
 
企業のお客様のほとんどは、「エンドツーエンド CA 署名 (End-to-End CA Signed)」セキュリティー設定を使用します。 **「エンドツーエンド CA 署名 (End-to-End CA Signed)」**設定を使用するためには、ご使用の Web サーバー上に有効な CA 署名証明書がインストールされている必要があります。 証明書の有効期限は先の日付でなければならず、*「ホスト名」*または*「サブジェクト代替名 (SAN)」*が対応していなければなりません。

