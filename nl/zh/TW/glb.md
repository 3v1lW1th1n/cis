---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: origin server, pool implementation, origin servers

subcollection: cis

---

{:shortdesc: .shortdesc} 
{:new_window: target="_blank"} 
{:note: .note}

# 廣域負載平衡器 (GLB) 概念
{:#global-load-balancer-glb-concepts}

此文件包含「廣域負載平衡器 (GLB)」的一些相關概念及定義，以及它對 IBM CIS 部署的影響。

## 廣域負載平衡器
{:#global-load-balancer-cis}

「廣域負載平衡器 (GLB)」管理位於多個地區之伺服器資源的資料流量。原點伺服器可以提供網站的所有內容，但前提是 Web 資料流量未擴展超過伺服器的處理功能，且延遲並不是主要考量。GLB 利用_儲存區_ 實作來容許資料流量配送至多個原點。此儲存區功能提供許多好處，包括：

  * 將回應時間縮到最短
  * 透過備援達到更高的可用性
  * 將資料流量傳輸量提到最高

GLB 將資料流量遞送至具有最高優先順序的儲存區，在其原點伺服器之間分配負載。有關資料流量在儲存區內的分配狀況，請參閱下列_儲存區_ 區段。如果主要儲存區變成無法使用，則會根據優先順序，自動將資料流量遞送至清單中的下一個儲存區。

如果是針對特定地區設定儲存區，則來自那些地區的資料流量會先傳送至所指定地區的儲存區。只有在所指定地區的所有儲存區都關閉時，才會將資料流量撤回到預設儲存區。在此情況下，撤回儲存區是具有最低優先順序的儲存區。 

### 如何運作
{:#how-glb-works}
建立 GLB 時，會以負載平衡器的名稱自動新增它的 DNS 記錄。然後，GLB 會將其中一個原點 IP 位址傳回給提出 DNS 要求的用戶端。

例如，所建立的原點儲存區具有兩個識別 `169.61.244.18` 及 `169.61.244.19` IP 位址的原點。如果使用原點儲存區建立名稱為 `glbcust.ibmmo.com` 的廣域負載平衡器，則網際網路上的用戶端可以執行下列指令：
```
$ ping glbcust.ibmom.com
PING glbcust.ibmom.com (169.61.244.18): 56 data bytes
```
在此範例中，CIS：

    * 已建立一個名稱為 `glbcust.ibmmo.com` 的 DNS 記錄
    * 已使用 GLB 將 DNS 名稱解析為原點儲存區中所識別的其中一個 IP 位址

請注意，廣域負載平衡器不會終止 TCP 連線。
{:note}

將 DNS 元素或 GLB 設為 "Proxy" 會變更此行為。
比方說，如果您開啟 Proxy，並將**安全 > TLS > 模式**變更為`關閉`以外的項目，則 CIS 現在會終止 TCP 連線，並建立 CIS 與發送端之間的第二個連線。

在此範例中，CIS：

    * 已建立一個名稱為 `glbcust.ibmmo.com` 的 DNS 記錄
    * 已使用 GLB 將 DNS 名稱解析為 CIS 提供的 IP 位址
    
現在，CIS 會終止與 `glbcust.ibmmo.com` 的連線，而 HTTPS 憑證是由 CIS 管理（這是 TCP 終止的必要條件）。

在用戶端連接至應用程式之後，圖片如下所示：

`[用戶端]<--tls-->[cis]<-->[原點伺服器]`

## 儲存區
{:#glb-pools}

儲存區是在連接至 GLB 時將資料流量聰明地遞送至其中的原點伺服器群組。使用者可以配置要標示為性能良好之儲存區的可用原點伺服器數目下限，以及要使用的特定性能檢查。原點儲存區可以與特定地區相關聯，也可以可供所有地區使用。

### 資料流量在儲存區內的分配
{:#distribution-of-traffic-within-a-pool}

依預設，所有資料流量會使用循環式通訊協定，在儲存區的原點之間平均分配。對於非 Proxy GLB 也是同樣情形。

原點可以配置加權，而對於 Proxy GLB，加權可決定每個原點伺服器相對於儲存區中的其他原點接收多少資料流量。加權配置為 0 與 1 之間的數字，並指定要傳送至原點的資料流量比例。 

對於每一個原點： 

` 傳送到原點之資料流量的百分比 = 原點加權 / 所有原點加權的總和`

如果所有原點的加權是 `1`，則資料流量會平均分配。 

加權為 `0` 的原點不會接收此儲存區的任何資料流量。不過，階段作業親緣性仍可能置換此狀況，直到所有階段作業關閉為止。如果原點是另一個儲存區中的成員，則它仍可能接收該儲存區的資料流量。

**範例：** 

已設定 3 個原點的原點儲存區具有下列加權：origin-A 為 0.4，origin-B 為 0.3，origin-C 為 0.3。 

* 一開始，所有原點都是性能良好。每一個原點接收的資料流量為：origin-A 40%，origin-B 30%，origin-C 30%。
* 然後，origin-A 變嚴重；它不再接收資料流量。其餘原點具有相同的加權，因此資料流量會平均分配，各接收 50%。
* 管理者會將 origin-C 的加權變更為 `0`。現在，100% 的新資料流量都會到 origin-B。但是，當階段作業親緣性開啟時，origin-C 的現有階段作業資料流量會繼續傳送至 origin-C，直到那些階段作業關閉為止（最多 24 小時）。

### 撤回儲存區
{:#fallback-pool}

優先順序最低（數字最大）的原點儲存區為指定的「撤回儲存區」。當所指定地區的所有儲存區都關閉時，資料流量會遞送至撤回儲存區（不論該儲存區的性能如何）。

當所有儲存區都停用時，無法使用撤回儲存區。
{:note}

## 性能檢查
{:#cis-health-check}

性能檢查有助於深入瞭解儲存區的可用性，以將資料流量遞送至性能良好儲存區。這些檢查會定期傳送 HTTP、HTTPS 或 TCP 要求，並監視回應。它們可以使用自訂的埠、逾時、狀態碼等等進行配置。只要儲存區標示為性能不佳，就會聰明地將資料流量重新遞送至另一個可用的儲存區。請注意，您的日誌會參照 Cloudflare，這是因為 IBM 與 Cloudflare 的夥伴關係加強了 CIS。
{:note}

### 性能檢查事件
{:#health-check-events}

「性能檢查事件」是指含連接性能檢查的儲存區及其相關聯原點伺服器的狀態變更。如果原點的狀態降級，則會在表格中出現一個含有事件說明的新項目。請導覽至**可靠性 > 廣域負載平衡器 > 性能檢查事件**，以查看「性能檢查事件」的表格。您可以從下拉功能表中選取過濾器參數，依日期、儲存區或原點的性能、儲存區名稱及原點名稱來過濾。表格中的直欄可透過按一下直欄名稱加以排序。
![「性能檢查事件」表格](images/health-check-events-table.png)

表格內的個別列會展開，以顯示該項目的相關資訊。如果儲存區性能良好，則只會顯示**儲存區詳細資料**磚。如果該列有嚴重的原點或欠佳的儲存區，也會出現**受影響原點詳細資料**磚。 

![「性能檢查事件」詳細資料](images/health-check-events-details.png)

#### 儲存區詳細資料：
* 儲存區名稱 - 儲存區的名稱
* 性能良好的原點 - 儲存區中性能良好的原點/原點總數的比例
* 性能良好臨界值 - 必須是性能良好才視為儲存區性能良好的原點數
* 性能良好的原點 - 性能良好原點的名稱
* 嚴重原點 - 性能不佳原點的名稱

#### 受影響原點詳細資料：
* 原點名稱 - 原點的名稱
* 原點位址 - 原點的位址
