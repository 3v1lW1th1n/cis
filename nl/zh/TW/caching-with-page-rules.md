---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: Use Page Rules, standard cache levels, Custom Caching Sets

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}

# 搭配使用頁面規則與快取
{:#use-page-rules-with-caching}

「頁面規則」可讓您根據頁面 URL 採取各種動作（例如，建立重新導向、微調快取行為，或啟用及停用服務）。

「頁面規則」會對符合下列格式的給定 URL 型樣生效：

`<scheme>://<hostname><:port>/<path>`

例如：

`https://www.example.com:80/image.png`

`scheme` 及 `port` 是選用元件。如果省略 `scheme` 元件，則格式會接受 `http://` 及 `https://` 通訊協定。如果未指定 `port`，則規則會符合所有埠。您可以在規則型樣中使用 `*` 符號，以執行基本萬用字元相符，讓它符合一連串的類似型樣。

**要記住的「頁面規則」重要事項：**

 * 只有一個「頁面規則」會對任何給定的要求生效。
 * 「頁面規則」的給定優先順序是從上到下的順序。URL 符合規則之後，只會套用該規則；亦即，如果已對要求觸發「頁面規則」，則任何也符合 URL 型樣的後續規則都不會生效。 
 * 一般而言，建議您將規則從「最具體」到「最不具體」進行排序。
 * 「頁面規則」可以予以停用，在這種情況下，這些規則將不會採取任何動作，但仍然可以顯示在清單中，並進行編輯。將*已啟用* 切換參數設為「關閉」會建立一開始予以停用的「頁面規則」。


## 轉遞（URL 重新導向）
{:#forwarding-url-redirection}

使用 HTTP 301 或 302 重新導向，將一個 URL 重新導向至另一個 URL。您可以使用 `$X` 語法來參照萬用字元所符合之任何 URL 區段的內容。`X` 指出型樣中 glob 的索引：將 `$1` 取代為第一個萬用字元相符項、將 `$2` 取代為第二個萬用字元相符項，依此類推。

例如，假設您設定下列規則：

![影像](images/url-redirection-example.png)

這時，`www.example.com/stuff/things` 的要求會重新導向至 `http://example.com/stuff/things`。

請小心不要建立一個會使網域指向本身作為目的地的重新導向。此錯誤可能會造成無限重新導向錯誤，而且無法解析受影響的 URL。
{:note}


## 重新導向至 HTTPS
{:#redirecting-to-https}

如果您要重新導向訪客以使用 HTTPS，則請改用**一律使用 HTTPS** 設定：

![影像 2](images/url-matching-patterns.png)


## 自訂快取
{:#custom-caching}

使用任何標準快取層次，設定任何符合「頁面規則」型樣之 URL 的快取行為。將**快取層次**設為**快取所有項目**可快取任何內容，即使它不是我們的其中一個預設靜態檔案類型也一樣。將**快取層次**設為**略過**設定，可防止在該 URL 上進行快取。

使用「頁面規則」指定快取層次時，您可以設定**邊緣快取 TTL**，而此項目控制 CIS 將檔案保留在快取中多久的時間。

**瀏覽器快取 TTL** 可控制用戶端瀏覽器所快取的資源保持有效多久的時間。如果瀏覽器再次要求資源，而且 TTL 尚未過期，則瀏覽器會收到 `HTTP 304（未修改）`回應。您可以設定 30 分鐘到 1 年範圍內的 TTL。

並非所有預設快取行為都嚴格符合 RFC 標準。透過「頁面規則」設定**原點快取控制**可使用較新的一組快取規則，以嘗試更緊密遵循 RFC，主要是與重新驗證有關。例如，`max-age=0` 的預設行為根本不會進行快取，而設定**原點快取控制**會進行快取，但它一律會重新驗證。

下列範例設定「頁面規則」，以快取 `/images` 資料夾中找到的所有項目。快取的資源在使用者瀏覽器中會於 30 分鐘內到期，而在 IBM CIS 資料中心內則於一天後到期：

![影像 3](images/url-example.png)

**提供過時內容**會從快取中提供頁面，即使您的伺服器關閉也一樣。訪客會看到網站的有限版本，並出現一則訊息指出他們處於離線瀏覽模式。 

這項特性會傳回 HTTP 狀態 503。當伺服器再次回到線上時，CSI 會無縫接軌讓訪客進入一般瀏覽。

如果所要求的頁面不在快取中，則訪客會看到錯誤頁面，通知他們所要求的頁面已離線。
如果啟用**快取所有項目**頁面規則，且有效期限設定低於快取頻率，則會依對應的間隔清除**提供過時內容**。
{:note}
