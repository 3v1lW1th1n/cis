---
  
copyright:
   years: 2018
lastupdated: "2018-03-13"
 
---


# CIS 設定的最佳作法

因為 IBM CIS 定位到您網路的邊緣，所以您需要採取一些步驟來確保其與 CIS 服務順利整合。以下是將 CIS 與原點伺服器整合的一些建議最佳作法。 

在變更您的 DNS 及啟動我們的 Proxy 服務之前或之後，您可以執行這些步驟。這些建議容許 IBM CIS 適當地連接至原點伺服器。它們可協助您防止任何 API 或 HTTPS 資料流量問題，以及協助您的日誌擷取客戶的正確 IP 位址，而不是保護的 CIS IP 位址。

以下是您需要設定的項目：

 * 最佳作法 1：還原客戶的起源 IP
 * 最佳作法 2：包含 CIS IP 位址
 * 最佳作法 3：確保安全設定不會干擾 API 資料流量
 * 最佳作法 4：盡可能嚴格地配置安全設定
 
## 最佳作法 1：知道如何還原客戶的起源 IP

作為反向 Proxy，我們在這些標頭中提供起源 IP：

  * `CF-Connecting-IP`
  * `X-Forwarded-For`
  * `True-Client-IP`（選用）

針對 Apache、Windows IIS 及 NGINX 這類基礎架構，您可以使用各種工具來還原使用者 IP 位址。

## 最佳作法 2：包含 CIS IP 位址以更平穩地整合

以下是要採取的兩個步驟：

  * 移除 CIS IP 位址的任何速率限制
  * 設定 ACL，僅容許 CIS IP 位址及其他授信單位

您可以[在此位置](whitelisted-ips.html)找到 IBM CIS 的已更新 IP 範圍清單。

## 最佳作法 3：檢閱安全設定，確定它們不會干擾 API 資料流量

IBM CIS 通常會移除連線額外負擔，以加速 API 資料流量。不過，預設安全位置可能會干擾許多 API 呼叫。建議您採取一些動作，防止在 Proxy 處理為作用中時干擾 API 資料流量。

 * 使用**頁面規則**特性，選擇性地關閉安全特性。
   * 使用 API 的 URL 型樣來建立「頁面規則」，例如 `api.example.com`
   * 新增下列規則行為：
      * 將**安全層次**選取為**基本上關閉**
      * 將 **TLS** 選取為**關閉**
      * 將**瀏覽器完整性檢查**選取為**關閉**
   * 選取**佈建資源**

 * 或者，您可以從「安全」頁面廣域地關閉 **Web 應用程式防火牆**。

| *「瀏覽器完整性檢查」的功能為何？* | 
|------------------------------------------------|
| *瀏覽器完整性檢查會尋找濫發垃圾郵件者經常濫用的 HTTP 標頭。它會拒絕以那些標頭存取您頁面的資料流量。它也會封鎖沒有使用者代理程式或新增非標準使用者代理程式的訪客（濫用機器人、搜索器或 API 常使用此策略）。*|

## 最佳作法 4：盡可能嚴格地配置安全設定

CIS 提供部分選項來加密資料流量。作為反向 Proxy，我們在資料中心關閉 TLS 連線，並開啟與原點伺服器的新 TLS 連線。針對使用 CIS 的終止，您可以從帳戶上傳自訂憑證、使用 CIS 為您佈建的萬用字元憑證，或執行這兩個動作。

### 上傳自訂憑證
 
您可以在建立企業網域時上傳公用及專用金鑰。如果您上傳自己的憑證，則會立即與加密資料流量相容，並且可以維護對憑證（例如，「延伸驗證 (EV)」憑證）的控制。請記住，如果您上傳自訂憑證，則將負責管理憑證。例如，IBM CIS 不會追蹤憑證到期日。 
 
### 或者，利用 CIS 所佈建的憑證
 
依預設，IBM CIS 已與數個「憑證管理中心 (CA)」合作，提供客戶的網域萬用字元憑證。設定這些憑證時可能需要手動驗證，而且您的支援團隊可以協助您執行這些額外的步驟。
 
### 將 TLS 設定變更為**端對端 CA 簽章**
 
我們大部分的企業客戶都會利用「端對端 CA 簽章」安全設定。**端對端 CA 簽章**設定需要 Web 伺服器上所安裝的有效 CA 簽章憑證。憑證到期日必須是未來日期，而且必須具有相符的*主機名稱* 或*主體替代名稱 (SAN)*。

