---
  
copyright:
   years: 2018
lastupdated: "2018-03-13"
 
---


# CIS 设置的最佳实践

由于 IBM CIS 位于网络边缘，因此需要采取几个步骤来保证与 CIS 服务的顺利集成。以下是将 CIS 与源服务器集成的一些建议的最佳做法。 

您可以在更改 DNS 并激活代理服务之前或之后执行这些步骤。这些建议使 IBM CIS 能够正确连接到源服务器。它们将帮助您防止 API 或 HTTPS 流量出现任何问题，让日志捕获到客户的正确 IP 地址，而不是保护性 CIS IP 地址。

以下是需要设置的内容：

 * 最佳实践 1：恢复客户的原始 IP
 * 最佳实践 2：合并 CIS IP 地址
 * 最佳实践 3：确保安全设置不会影响 API 流量
 * 最佳实践 4：尽可能严格地配置安全设置
 
## 最佳实践 1：了解如何恢复客户的原始 IP

作为逆向代理，在以下头中提供原始 IP：

  * `CF-Connecting-IP`
  * `X-Forwarded-For`
  * `True-Client-IP`（可选）

可以使用各种工具针对基础结构（例如，Apache、Windows IIS 和 NGINX）恢复用户 IP 地址。

## 最佳实践 2：合并 CIS IP 地址以顺利集成

可以采取以下两个步骤：

  * 除去对 CIS IP 地址的任何速率限制
  * 设置 ACL 以仅允许 CIS IP 地址和其他可信参与方

您可以在[此位置](whitelisted-ips.html)找到 IBM CIS 的 IP 范围的更新列表。

## 最佳实践 3：复审安全设置以确保其不会干扰 API 流量

IBM CIS 通常通过除去连接开销来加速 API 流量。但是，缺省安全状态可能会干扰很多 API 调用。建议您执行一些操作，以防止在代理活动后干扰 API 流量。

 * 可以选择使用**页面规则**功能关闭安全功能。
   * 使用 API 的 URL 模式（例如，`api.example.com`）创建页面规则。
   * 添加以下规则行为：
      * 将**安全级别**选择为**彻底关闭**
      * 将 **TLS** 选择为**关闭**
      * 将**浏览器完整性检查**选择为**关闭**
   * 选择**供应资源**

 * 或者，可以从“安全性”页面全局关闭 **Web 应用程序防火墙**。

| *浏览器完整性检查有何功能？*| 
|------------------------------------------------|
| *浏览器完整性检查查找通常被垃圾邮件制造者所滥用的 HTTP 头。此检查会拒绝那些头访问页面时所带来的流量。它还会阻止没有用户代理或添加非标准用户代理（通常滥用的 bot、搜寻器或 API 或使用此策略）的访客。*|

## 最佳实践 4：尽可能严格地配置安全设置

CIS 提供了一些选项用于加密流量。作为逆向代理，关闭数据中心的 TLS 连接，新建与源服务器的 TLS 连接。如果与 CIS 中断连接，那么可以从帐户上传定制证书，也可以使用 CIS 供应的通配符证书，还可以同时使用这两种方法。

### 上传定制证书
 
可以在创建企业域时上传公共和专用密钥。如果上传自己的证书，则立即与加密流量兼容，并保持对证书（例如，扩展验证 (EV) 证书）的控制。请记住，如果上传定制证书，那么将需要管理此证书。例如，IBM CIS 不会跟踪证书到期日期。 
 
### 或者，使用 CIS 供应的证书
 
缺省情况下，IBM CIS 与多个认证中心 (CA) 建立了合作伙伴关系，为客户提供域通配符证书。设置这些证书时可能需要手动验证，您的支持团队可以帮助您执行这些额外的步骤。
 
### 将 TLS 设置更改为**端到端 CA 签名**
 
大多数企业客户使用“端到端 CA 签名”安全设置。**端到端 CA 签名**设置需要在 Web 服务器上安装有效的 CA 签名证书。证书的到期日期必须为将来日期，并且必须具有匹配的 *hostname* 或*主题备用名称 (SAN)*。

