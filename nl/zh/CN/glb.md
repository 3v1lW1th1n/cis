---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: origin server, pool implementation, origin servers

subcollection: cis

---

{:shortdesc: .shortdesc} 
{:new_window: target="_blank"} 
{:note: .note}

# 全局负载均衡器 (GLB) 概念
{:#global-load-balancer-glb-concepts}

本文档包含一些与全局负载均衡器 (GLB) 相关的概念和定义，还介绍了它如何影响 IBM CIS 部署。

## 全局负载均衡器
{:#global-load-balancer-cis}

全局负载均衡器 (GLB) 管理多个区域中的多个服务器资源之间的流量。源服务器可以为 Web 站点提供所有内容，前提是 Web 流量不超过服务器的处理能力，并且等待时间不是主要问题。GLB 利用允许将流量分发到多个源的_池_实现。该池功能提供多个优势，包括：

  * 最大限度地缩短响应时间
  * 通过冗余提高可用性
  * 最大限度地提高流量吞吐量

GLB 将流量路由到具有最高优先级的池，在其源服务器之间分布负载。请参阅以下_池_部分，以了解如何在池中分布流量。如果主池变为不可用，那么会根据优先级将流量自动路由到列表中的下一个池。

如果针对特定区域设置池，那么首先将来自这些区域的流量发送到指定区域的池。仅当给定区域的所有池都停机时，流量才会回退到缺省池。在此情况下，回退池是具有最低优先级的池。 

### 工作方式
{:#how-glb-works}
创建 GLB 时，会自动使用负载均衡器名称为其添加 DNS 记录。然后，GLB 将其中一个源 IP 地址返回给发出 DNS 请求的客户机。

例如，将使用标识 IP 地址 `169.61.244.18` 和 `169.61.244.19` 的两个源创建源池。如果使用源池通过名称 `glbcust.ibmmo.com` 创建全局负载均衡器，那么因特网上的客户机可执行以下命令：
```
$ ping glbcust.ibmom.com
PING glbcust.ibmom.com (169.61.244.18): 56 data bytes
```
在此示例中，CIS：

    * 创建名为 `glbcust.ibmmo.com` 的 DNS 记录
    * 使用 GLB 以将 DNS 名称解析为源池中标识的一个 IP 地址

请注意，全局负载均衡器不会终止 TCP 连接。
{:note}

将 DNS 元素或 GLB 设置为“proxy”将更改行为。
例如，如果开启代理并将**安全性 > TLS > 方式**设置为`关闭`之外的某个选项，那么 CIS 现在会终止 TCP 连接，并在 CIS 和发起方之间建立另一个连接。

在此示例中，CIS：

    * 创建名为 `glbcust.ibmmo.com` 的 DNS 记录
    * 使用 GLB 以将 DNS 名称解析为 CIS 提供的 IP 地址
    
现在，CIS 将终止与 `glbcust.ibmmo.com` 的连接，并且 CIS 托管 HTTPS 证书（这是 TCP 终止所必需的）。

客户机连接到应用程序后，图片如下所示：

`[客户机]<--tls-->[cis]<-->[源服务器]`

## 池
{:#glb-pools}

池是一组源服务器，在池连接到 GLB 时，会将流量智能路由到池中。用户可以配置池中最少有多少源服务器时可将池标记为正常运行，也可以配置要使用哪种特定的运行状况检查。源池可以与特定区域相关联，也可以使其对所有区域都可用。

### 池中流量的分布
{:#distribution-of-traffic-within-a-pool}

缺省情况下，所有流量都使用循环协议在池中的源之间均匀分布。对于非代理 GLB 也是如此。

可以使用权重配置源，并且对于代理的 GLB，权重确定每个源服务器相对于池中的其他源接收多少流量。权重配置为 0 到 1 之间的数字，并指定流量的多大比例将转至该源。 

对于每个源： 

`源的流量百分比 = 源权重/所有源权重总和`

如果所有源都具有权重 `1`，那么流量会平均分布。 

权重为 `0` 的源不会接收此池的任何流量。但是，会话亲缘关系可能仍会覆盖此项，直至所有会话关闭为止。如果源是另一个池中的成员，那么它可能仍会接收该池的流量。

**示例：** 

通过具有以下权重的 3 个源设置了一个源池：origin-A：0.4、origin-B：0.3 和 origin-C：0.3。 

* 最初，所有源均正常运行。每个源接收的流量比例为：origin-A：40%、origin-B：30% 和 origin-C：30%。
* 然后，origin-A 进入临界状态；它不再接收流量。其余源具有相同权重，因此流量均匀分布，每个接收 50%。
* 管理员将 origin-C 的权重更改为 `0`。现在新流量 100% 进入 origin-B。但是由于开启了会话亲缘关系，origin-C 上的现有会话的流量继续进入 origin-C，直至这些会话关闭（最长为 24 小时）。

### 回退池
{:#fallback-pool}

优先级最低（数值最大）的源池是指定的“回退池”。在给定区域的所有池停机时，流量将路由到回退池，而无论其运行状况如何。

禁用所有池时，回退池不可用。
{:note}

## 运行状况检查
{:#cis-health-check}

运行状况检查有助于深入了解池的可用性，以便可以将流量路由到运行正常的池。这些检查定期发送 HTTP、HTTPS 或 TCP 请求并监视响应。可以使用定制端口、时间间隔、超时和状态码等进行配置。一旦将池标记为运行不正常，流量将智能地重新路由到其他可用池。请注意，由于 IBM 与 Cloudflare 合作来支持 CIS，您的日志包含对 Cloudflare 的引用。
{:note}

### 运行状况检查事件
{:#health-check-events}

运行状况检查事件是来自池的状态更改，其中池包含已连接的运行状况检查及其关联的源服务器。如果源的状态下降，那么表中将出现一个包含事件描述的新项。导航至**可靠性 > 全局负载均衡器 > 运行状况检查事件**以查看“运行状况检查事件”表。您可以通过从下拉菜单中选择过滤器参数，按日期、池或源的运行状况、池名称和源名称进行过滤。可通过单击列名对表中的列进行排序。![“运行状况检查事件”表](images/health-check-events-table.png)

表中的各个行将展开，其中显示有关相应条目的更多信息。如果池运行正常，那么仅显示**池详细信息**磁贴。如果行中包含处于临界状态的源或者已降级的池，那么还会显示**受影响的源详细信息**磁贴。 

![“运行状况检查事件”详细信息](images/health-check-events-details.png)

#### 池详细信息：
* 池名称 - 池的名称
* 正常运行的源比率 - 正常运行的源/池中源总数的比率
* 运行状况阈值 - 要将池视为正常运行，需要正常运行的源的数量
* 正常运行的源 - 正常运行的源的名称
* 临界状态的源 - 未正常运行的源的名称

#### 受影响的源详细信息：
* 源名称 - 源的名称
* 源地址 - 源的地址
