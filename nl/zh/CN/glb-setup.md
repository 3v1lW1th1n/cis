---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: health checks, origin pools, load balancers, IBM CIS

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}


# 设置和配置负载均衡器
{:#set-up-and-configure-your-load-balancers}
 
 IBM CIS 提供全局负载均衡作为一项服务。以下是 GLB 仪表板的外观：

![图像](images/glb-screen.png)

## GLB 仪表板
{:#glb-dashboard}

在仪表板上，将看到三个列表，其中显示负载均衡器、源池和运行状况检查。这些列表显示新的或更新的全局负载均衡器，在供应或更新其中一个组件后还会显示此组件。最初列表为空，并且在创建负载均衡器之前，必须执行一些操作。

如果您已知道需要执行的操作，请参阅[快速入门指南](/docs/infrastructure/cis?topic=cis-global-load-balancer-quick-setup)！

### 创建
{:#create-health-check}

<sup>`*`</sup> 指示此步骤是可选的
{:note}

1) <sup>`*`</sup>创建运行状况检查，单击**创建运行状况检查**。
![图像](images/glb-health-check-list.png)
    <ul>
      <li><b>路径</b>：对其进行运行状况检查的端点路径。</li> 
      <li><b>类型</b>：要用于运行状况检查的协议。</li>
      <li><b>描述</b>：用户提供的描述。</li>
    </ul>

2) 创建池，单击**创建池**。
  ![图像](images/glb-pool-list.png)
    <ul>
      <li><b>运行状况</b>：池的状态。</li>
      <li><b>名称</b>：用户提供的名称。</li>
      <li><b>源数</b>：池中运行正常的源的计数。</li>
      <li><b>运行状况检查</b>：附加的运行状况检查（如果有）的路径。</li>
    </ul>

3) 创建负载均衡器，单击**创建负载均衡器**。
  ![图像](images/glb-load-balancer-list.png)
    <ul>
      <li><b>运行状况</b>：负载均衡器的状态。</li>
      <li><b>主机名</b>：在域名之前添加的名称。</li>
      <li><b>可用池数</b>：运行正常的池的计数。</li>
      <li><b>TTL</b>：生存时间。</li>
      <li><b>代理</b>：启用或禁用代理流量流。</li>
      <li><b>状态</b>：启用或禁用负载均衡器。</li>
    </ul>

IBM 的地理区域与 Cloudflare 的区域不同。有关 Cloudflare 使用的地理区域的详细信息，请参阅 [Load Balancing: Geographic Regions ![外部链接图标](../../icons/launch-glyph.svg "外部链接图标")](https://support.cloudflare.com/hc/en-us/articles/115000540888-Load-Balancing-Geographic-Regions){:new_window}。  
{:note}

### 编辑/删除
{:#edit-delete-load-balancer}
要编辑或删除负载均衡器或其某个组件，请单击位于每行最右侧的溢出菜单按钮。

“溢出”菜单按钮：

![图像](images/overflow.png)

为每个列表提供了以下选项。

* 运行状况检查
    * **查看运行状况检查**：此选项显示运行状况检查的简短摘要以及引导您进入编辑流程的链接。
    * **编辑运行状况检查**：此选项会将用户重定向到编辑流程。 
    * **删除运行状况检查**：此选项会显示删除流的确认对话框。

* 池
    * **查看池详细信息**：此选项将显示包含有关池的信息的模态对话框。
    * **编辑池**：此选项会将用户重定向到编辑流。
    * **删除池**：此选项会显示删除流的确认对话框。

* 负载均衡器
    * **禁用/启用**：启用或禁用负载均衡器。
    * **编辑负载均衡器**：重定向到编辑流。 
    * **删除负载均衡器**：显示删除流的确认对话框。

## 添加运行状况检查
{:#add-a-health-check}

运行状况检查是源池的可选附件。此检查使用定制重复时间间隔来探测特定响应主体或状态码，以监视池的运行状况。创建了运行状况检查后，就可以将其添加至新的源池或现有源池。

创建运行状况检查时，只有一个字段是必需的：
 * **响应代码**：运行状况检查的预期 HTTP 响应代码或代码范围。此值必须在 200 到 299 之间，通配符由“x ”表示。

其他可选字段：
 * **路径**：对其执行运行状况检查的端点路径（缺省为 /）。
 * **类型**：要用于运行状况检查的协议（缺省为 HTTP）。
 * **描述**：运行状况检查描述。
 * **时间间隔**：每次运行状况检查之间的时间间隔（秒）。较短的时间间隔可能会缩短故障转移时间，但会增加对源的负载，因为检查来自多个位置（缺省值为 60）。
 * **方法**：要用于运行状况检查的 HTTP 方法（缺省值为 GET）。
 * **超时**：将运行状况检查标记为失败之前的时间（秒），缺省值为 5 秒。
 * **重试次数**：超时情况下将源标记为运行不正常之前尝试重试的次数。立即尝试重试（缺省值为 2）。
 * **响应主体**：要在响应主体中匹配的不区分大小写的子字符串。如果未找到此字符串，那么会将源标记为运行不正常。
 * **请求头**：要在运行状况检查中发送的 HTTP 请求头。缺省情况下，建议设置 Host 头。无法覆盖 `User-Agent` 头。

## 添加池
{:#add-a-pool}

每个供应的负载均衡器至少需要一个池。池将您的源分组以供负载均衡器使用。

创建池时，以下两个字段是必需的：
 * **名称**：池的短名称（标记）。仅允许字母数字字符、连字符和下划线。
 * **源**：此池中源的列表。如果池本身运行正常，那么定向到此池的流量会在所有当前运行正常的源中均衡分发。

其他可选字段：
 * **描述**：人类可以阅读的池描述。
 * **已启用**：是否启用（缺省值）此池。已禁用的池不会接收流量，不会进行运行状况检查。禁用池将导致使用该池的任何负载均衡器故障转移到下一个池（如果有），缺省为 true。
 * **运行正常的源的阈值**：池中最少必须有多少个源正常运行，此池才能处理流量。如果运行正常的源的数量小于此数字，那么会将该池标记为运行不正常，并将故障转移到下一个可用池。（缺省值为 1）
 * **运行状况检查区域**：运行状况检查将执行监视的区域。**注**：IBM 的地理区域与 Cloudflare 的区域不同。有关 Cloudflare 使用的地理区域的详细信息，请参阅 [Load Balancing: Geographic Regions ![外部链接图标](../../icons/launch-glyph.svg "外部链接图标")](https://support.cloudflare.com/hc/en-us/articles/115000540888-Load-Balancing-Geographic-Regions){:new_window}。 
 * **运行状况检查**：要用于检查此池中源的运行状况检查。（缺省情况下，没有运行状况检查）
 * **通知电子邮件**：应该接收运行状况通知的电子邮件地址。此地址可以是单个邮箱，也可以是邮件列表。

## 添加负载均衡器
{:#add-a-load-balancer}

负载均衡器可使用循环分发在多个源池之间分发代理流量。

创建负载均衡器时，以下字段是必需的：
 * **名称**：要与负载均衡器关联的 DNS 主机名。如果此主机名已作为 DNS 记录存在于 IBM 的 DNS 中，那么负载均衡器会优先，而不会使用 DNS 记录。
 * **缺省池**：池标识的列表。该列表按其故障转移优先级排序。缺省情况下，或没有为给定区域配置区域池时，将使用此处定义的池。

（可选）可以配置以下字段：
 * **代理**：通过 IBM 的性能和度量服务路由流量。
 * **会话亲缘关系**：始终通过同一性能和度量实例进行路由。仅当启用了代理时，此选项才可用。
 * **TTL**：此负载均衡器返回的 IP 地址对应的 DNS 条目的生存时间 (TTL)。此选项仅适用于未代理的负载均衡器，否则缺省为 `Automatic`。
 * **区域池**：从区域或者国家或地区代码到给定区域的池列表的映射（列表中的池按故障转移优先级排序）。未明确定义区域池的区域将使用缺省池。**注**：IBM 的地理区域与 Cloudflare 的区域不同。有关 Cloudflare 使用的地理区域的详细信息，请参阅 [Load Balancing: Geographic Regions ![外部链接图标](../../icons/launch-glyph.svg "外部链接图标")](https://support.cloudflare.com/hc/en-us/articles/115000540888-Load-Balancing-Geographic-Regions){:new_window}。 
 
有关此文档中使用的术语（通常是整个行业中使用的通用术语）的定义，请参阅[词汇表](/docs/infrastructure/cis?topic=cis-glossary)。
