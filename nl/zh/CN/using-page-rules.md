---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: Use Page Rules, Page Rule

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}


# 使用页面规则
{:#use-page-rules}

“页面规则”指定一些设置和值，您可以将这些设置和值应用于引用您的域的特定 URL 模式。“页面规则”帮助您根据站点中的每个单独的 URL 来管理安全性、性能和可靠性。下表描述了适用于所有客户的“页面规则”、规则所生成的行为以及在使用这些规则前应注意的任何特殊注意事项。

## 安全性
{:#page-rules-security}

|**设置** |**行为** |**注意事项**|
|-----------|----------|----------------|
|**浏览器完整性检查**|查找垃圾邮件制造者滥用的常见 HTTP 头，并拒绝访问您的页面。还会阻止无用户代理或者添加非标准用户代理（通常被滥用机器人、搜寻器或 API 使用）的访问者。| |
|**禁用安全性**|禁用以下功能：<ul><li>电子邮件模糊处理</li> <li>服务器端排除</li> <li>WAF</li></ul>|如果将一个规则设置为禁用安全性，并且将另一个规则设置为启用 WAF，那么无论规则出现顺序如何，都是 WAF 规则优先。|
|**电子邮件模糊处理**|开启或关闭电子邮件模糊处理。| |
|**IP 地理定位头**|通过 Web 站点的所有请求，包含访问者位置的国家或地区代码。可在 `CF-IPCountry` HTTP 头中找到此信息。| |  
|**安全级别**|控制在客户机威胁分数为多高时客户机将遇到质询页面。可以使用此设置，以便在访问者访问您的站点时站点总是向他们呈现**防御模式**质询。| |
|**服务器端排除**|开启或关闭“服务器端排除”。| |
|**TLS**|控制所使用的 TLS 模式。| |
|**WAF**|开启或关闭 WAF。| |  
|**自动 HTTPS 重写**|开启或关闭“自动 HTTPS 重写”。| |
|**随机加密**|开启或关闭“随机加密”。| |
|**高速缓存欺骗防护**|开启或关闭“高速缓存欺骗防护”。| |
|**始终使用 HTTPS**|通过创建 `301` 重定向，将任何 `http://` URL 转换为 `https://` URL。|使用此设置将禁用配置规则的所有其他设置，因为 IBM CIS 强制请求重定向至 `HTTPS`，这成为将针对“页面规则”进行评估的新请求。|
|**真实的客户机 IP 头**|CIS 将在 `True-Client-IP` 头中发送最终用户的 IP 地址。|仅企业
|

## 性能
{:#page-rules-performance}

|**设置** |**行为** |**注意事项**|
|-----------|----------|----------------|
|**浏览器高速缓存 TTL**|控制客户机浏览器高速缓存的资源的有效时间。| |
|**存在 Cookie 时绕过高速缓存**|除非看到特定名称的 cookie，否则将提供高速缓存的对象，例如，除非看到指示客户已登录的 `SessionID` cookie 并因此应显示个性化内容，否则提供高速缓存版本的主页。| |
|**高速缓存级别**|**绕过** - 不高速缓存匹配此“页面规则”的资源。<br>**无查询字符串** - 只有在不存在查询字符串时才交付来自高速缓存的资源。<br>**忽略查询字符串** - 向每个人交付相同的资源，与查询字符串无关。<br>**标准** - 每次在查询字符串更改时交付不同的资源。<br> **高速缓存所有内容** - 高速缓存匹配“页面规则”的资源。|缺省情况下，不会高速缓存 HTML 内容。必须编写用于高速缓存静态 HTML 内容的“页面规则”。|
|**边缘高速缓存 TTL**|控制 IBM CIS 将文件保留在高速缓存中的时间长度。|在指定高速缓存级别时，此设置为可选。|
|**解析覆盖**|更改与页面规则匹配的请求所解析为的 URL 或 IP。||
|**cookie 上的高速缓存**|根据针对 cookie 名称的正则表达式匹配，应用`高速缓存所有内容`选项（`高速缓存级别`设置）。如果将此设置和`存在 Cookie 时绕过高速缓存`设置添加到相同页面规则，那么`在 Cookie 上高速缓存`优先于`存在 Cookie 时绕过高速缓存`。|仅企业 |
|**禁用性能**|关闭：<ul><li>`合并压缩 Web 内容`</li><li>`图像装入优化`</li><li>`图像大小优化`</li><li>`脚本装入优化`</li></ul> |仅企业
|
|**合并压缩 Web 内容**|通过从 HTML、CSS 和/或 JavaScript 文件中除去所有不必要的字符，从而合并压缩这些文件。|仅企业 |
|**图像装入优化**|通过以下方式，基于网络连接和设备类型，缩短包含图像的页面的装入时间：<ul><li>**图像虚拟化** - 将图像替换为尺寸与原始图像（包括第三方图像）相同的低分辨率占位符图像。在页面完全呈现后，延迟装入完整分辨率的图像（在浏览器视区中划分图像优先级）。此过程允许页面快速呈现，并最大限度减少浏览器回流。</li><li>**请求简化** - 将针对图像的多个独立网络请求组合为单个请求。</li></ul> |仅企业
|
|**图像大小优化**|通过除去元数据（日期和时间、摄像头制造商和型号等）并尽可能压缩图像，从而减小图像文件大小。文件大小越小意味着图像和 Web 页面的装入速度越快。|仅企业
|
|**排序查询字符串**|将具有相同查询字符串的文件视为高速缓存中的相同文件，而不考虑查询字符串的顺序。|仅企业
|
|**响应缓冲**|为来自源服务器的响应启用或禁用缓冲。缺省情况下，CIS 会在我们收到包时将包发送给客户机。启用“响应缓冲”意味着 CIS 将等待至获取整个文件为止，然后再将其转发给最终用户。|仅企业 |
|**脚本装入优化**|通过异步装入 Javascript（包括第三方脚本）以使它们不会阻止呈现页面内容，从而缩短绘制时间。|仅企业 |

## 可靠性
{:#page-rules-reliability}

|**设置** |**行为** |**注意事项**|
|-----------|----------|----------------|
|**提供旧内容**|如果服务器宕机，保持有限版本的站点联机。|有关更多信息，请查看[管理 CIS 部署以获取最佳可靠性](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability) |
|**源高速缓存控制**|确定从源高速缓存的内容以及更新内容的频率|有关更多信息，请查看[管理 CIS 部署以获取最佳可靠性](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability) |
|**转发 URL**|站点不可用时使用的 URL。|使用此设置将禁用配置所有其他设置，因为会将请求转发至其他位置。有关更多信息，请查看[管理 CIS 部署以获取最佳可靠性](/docs/infrastructure/cis?topic=cis-manage-your-ibm-cis-deployment-for-optimal-reliability)|
|**主机头覆盖**|将与页面规则匹配的 URI 的主机头替换为指定的值。这通常用于在 S3 存储区中托管的内容。|
|**禁用应用程序**|关闭所有 CIS 应用程序。|仅企业
|
|**源错误页面传递**|禁用将针对从源服务器发送的问题触发的 CIS 错误页面，而改为显示在源中设置的错误页面。|仅企业
||

## 页面规则 URL 模式
{:#page-rule-url-patterns}

“页面规则”将针对匹配以下格式的给定 URL 模式生效：

`<scheme>://<hostname><:port>/<path>`

使用每个组件的示例如下：

`https://www.example.com:80/image.png`

*方案*和*端口*组件为可选。如果省略方案，那么将涵盖 `http://` 和 `https://` 协议。如果未指定端口，那么规则将匹配所有端口。您可以通过在规则模式中使用“*”符号来执行基本通配符匹配，允许其匹配一系列类似模式，而不是仅一个。

以下是使用“页面规则”时需要记住的三个重要事项：

 * 对于任何给定的请求，仅一个“页面规则”生效。
 * “页面规则”的优先级按从上到下顺序排序。
 * 一旦 URL 匹配某个规则，那么仅将应用此规则；也就是，如果请求已触发一个“页面规则”，那么匹配 URL 模式的任何后续规则都不会生效。一般情况下，建议从_最具体_到_最不具体_对规则进行排序。

可禁用“页面规则”，在此情况下，它们不起任何作用。规则仍可在列表中显示并且可进行编辑。将**已启用**切换为**关闭**会创建初始禁用的“页面规则”。

有关更多信息，请参阅[高速缓存和页面规则指南文档](/docs/infrastructure/cis?topic=cis-use-page-rules-with-caching)。
