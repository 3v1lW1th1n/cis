---

copyright:
  years: 2018, 2019
lastupdated: "2019-03-14"

keywords: Use Page Rules, standard cache levels, Custom Caching Sets

subcollection: cis

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:DomainName: data-hd-keyref="DomainName"}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:generic: data-hd-programlang="generic"}

# 캐싱에서 페이지 규칙 사용
{:#use-page-rules-with-caching}

페이지 규칙은 페이지의 URL을 기반으로 다양한 조치를 취할 수 있는 기능을 제공합니다(예: 경로 재지정 작성, 캐싱 작동 미세 튜닝 또는 서비스 사용 및 사용 안함).

페이지 규칙은 다음 형식과 일치하는 주어진 URL 패턴에 영향을 줍니다.

`<scheme>://<hostname><:port>/<path>`

예를 들어 다음과 같습니다.

`https://www.example.com:80/image.png`

`scheme` 및 `port` 컴포넌트는 선택사항입니다. `scheme` 컴포넌트가 생략되면 형식에서 `http://` 및 `https://` 프로토콜을 채택합니다. `port`가 지정되지 않으면 규칙이 모든 포트와 일치됩니다. 일련의 유사한 패턴의 일치를 허용하기 위해 규칙 패턴에서 `*` 기호를 사용하여 기본 와일드카드 일치를 수행할 수 있습니다.

**페이지 규칙에서 유념해야 할 중요사항:**

 * 오직 하나의 페이지 규칙만 주어진 요청에서 적용됩니다.
 * 페이지 규칙에는 맨 위에서 맨 아래 순으로 우선순위가 지정됩니다. 일단 URL이 규칙과 일치되면 해당 규칙만 적용됩니다. 즉, 페이지 규칙이 요청에서 이미 트리거된 경우에는 역시 URL 패턴과 일치하는 후속 규칙이 적용되지 않습니다. 
 * 일반 규칙으로서, 가장 특정한 규칙에서 가장 특정하지 않은 규칙으로 순서를 지정하도록 권장합니다.
 * 페이지 규칙을 사용하지 않을 수 있습니다. 이 경우에 이는 조치를 취하지 않지만 여전히 목록에 표시되고 편집될 수 있습니다. *사용됨* 토글을 "끄기"로 설정하면 초기에 사용되지 않은 페이지 규칙이 작성됩니다.


## 전달(URL 경로 재지정)
{:#forwarding-url-redirection}

HTTP 301 또는 302 경로 재지정을 사용하여 하나의 URL을 다른 URL로 경로 재지정합니다. 와일드카드가 일치하는 URL 섹션의 컨텐츠는 `$X` 구문을 사용하여 참조될 수 있습니다. `X`는 패턴에서 방울의 인덱스를 표시합니다. `$1`은 첫 번째 와일드카드 일치로 대체되며, `$2`는 두 번째 와일드카드 일치로 대체됩니다. 나머지도 마찬가지입니다.

예를 들어, 다음 규칙을 설정한다고 가정합니다.

![이미지](images/url-redirection-example.png)

여기서 `www.example.com/stuff/things`에 대한 요청은 `http://example.com/stuff/things`로 경로 재지정됩니다.

도메인이 스스로를 대상으로 가리키는 경로 재지정을 작성하지 않도록 주의하십시오. 이러한 실수로 인해 무한 경로 재지정 오류가 발생할 수 있으며 적용된 URL을 분석하지 못할 수 있습니다.
{:note}


## HTTPS로 경로 재지정
{:#redirecting-to-https}

HTTPS를 사용하도록 방문자를 경로 재지정하려면 **항상 HTTPS 사용** 설정을 대신 사용하십시오.

![이미지2](images/url-matching-patterns.png)


## 사용자 정의 캐싱
{:#custom-caching}

표준 캐시 레벨 중 하나를 사용하여 페이지 규칙 패턴과 일치하는 URL의 캐싱 작동을 설정합니다. **캐시 레벨**을 **모두 캐시**로 설정하면 기본 정적 파일 유형 중 하나가 아니어도 모든 컨텐츠가 캐시됩니다. **캐시 레벨**을 **무시** 설정으로 설정하면 해당 URL에서 캐싱이 발생하지 않습니다.

페이지 규칙을 사용하여 캐시 레벨를 지정하는 경우, CIS이 캐시에 파일을 보관하는 기간을 제어하는 **에지 캐시 TTL**을 설정할 수 있습니다.

**브라우저 캐시 TTL**은 클라이언트 브라우저에서 캐시한 리소스가 유효한 상태를 유지하는 기간을 제어합니다. 브라우저가 리소스를 다시 요청하고 TTL이 만료되지 않은 경우, 브라우저는 `HTTP 304 (Not Modified)` 응답을 수신합니다. TTL 범위를 30분에서 1년까지 설정할 수 있습니다.

모든 기본 캐싱 작동이 엄격하게 RFC를 준수하지는 않습니다. 페이지 규칙을 이용한 **오리진 캐시 제어** 설정에서는 주로 재인증과 관련하여 RFC에 보다 가까이서 접근하려고 하는 신규 캐시 세트 규칙을 사용합니다. 예를 들어, `max-age=0`의 기본 작동은 전혀 캐시를 수행하지 않지만 **오리진 캐시 제어** 설정은 캐시를 수행하되 항상 재인증합니다.

다음 예제는 `/images` 폴더에서 찾은 모든 항목을 캐시하도록 페이지 규칙을 설정합니다. 캐시된 리소스는 사용자의 브라우저에서 30분이 되면 만료되며 IBM CIS 데이터 센터에서 하루가 지나면 만료됩니다.

![이미지3](images/url-example.png)

**시간이 경과된(stale) 컨텐츠 제공**에서는 서버가 작동 중지된 경우에도 캐시에서 페이지를 제공합니다. 방문자는 오프라인 찾아보기 모드에 있다는 메시지와 함께 제한된 버전의 사이트를 보게 됩니다. 

이 기능은 HTTP 상태 503을 리턴합니다. 서버가 다시 온라인 상태가 되면 CIS는 방문자를 일반 브라우징으로 매끄럽게 안내합니다.

캐시에 요청된 페이지가 없는 경우, 방문자는 요청 중인 페이지가 오프라인 상태임을 알려주는 오류 페이지를 보게 됩니다.
만기가 캐싱 빈도보다 적게 설정된 상태에서 **모두 캐시** 페이지 규칙이 사용되면 **시간이 경과된(stale) 컨텐츠 제공**이 해당 간격으로 제거됩니다.
{:note}
